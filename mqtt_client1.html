<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weboscoket MQTT</title>


<style type="text/css">
  

select {
  /* styling */
  background-color: white;
  border: thin solid blue;
  border-radius: 4px;
  display: inline-block;
  font: inherit;
  line-height: 1.5em;
  padding: 0.5em 3.5em 0.5em 1em;

  /* reset */

  margin: 10px;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  -webkit-appearance: none;
  -moz-appearance: none;
}

/* arrows */

select.classic {
  background-image: linear-gradient(45deg, transparent 50%, blue 50%),
    linear-gradient(135deg, blue 50%, transparent 50%),
    linear-gradient(to right, skyblue, skyblue);
  background-position: calc(100% - 20px) calc(1em + 2px),
    calc(100% - 15px) calc(1em + 2px), 100% 0;
  background-size: 5px 5px, 5px 5px, 2.5em 2.5em;
  background-repeat: no-repeat;
}

select.classic:focus {
  background-image: linear-gradient(45deg, white 50%, transparent 50%),
    linear-gradient(135deg, transparent 50%, white 50%),
    linear-gradient(to right, gray, gray);
  background-position: calc(100% - 15px) 1em, calc(100% - 20px) 1em, 100% 0;
  background-size: 5px 5px, 5px 5px, 2.5em 2.5em;
  background-repeat: no-repeat;
  border-color: grey;
  outline: 0;
}

select.round {
  background-image: linear-gradient(45deg, transparent 50%, gray 50%),
    linear-gradient(135deg, gray 50%, transparent 50%),
    radial-gradient(#ddd 70%, transparent 72%);
  background-position: calc(100% - 20px) calc(1em + 2px),
    calc(100% - 15px) calc(1em + 2px), calc(100% - 0.5em) 0.5em;
  background-size: 5px 5px, 5px 5px, 1.5em 1.5em;
  background-repeat: no-repeat;
}

select.round:focus {
  background-image: linear-gradient(45deg, white 50%, transparent 50%),
    linear-gradient(135deg, transparent 50%, white 50%),
    radial-gradient(gray 70%, transparent 72%);
  background-position: calc(100% - 15px) 1em, calc(100% - 20px) 1em,
    calc(100% - 0.5em) 0.5em;
  background-size: 5px 5px, 5px 5px, 1.5em 1.5em;
  background-repeat: no-repeat;
  border-color: green;
  outline: 0;
}

select.minimal {
  background-image: linear-gradient(45deg, transparent 50%, gray 50%),
    linear-gradient(135deg, gray 50%, transparent 50%),
    linear-gradient(to right, #ccc, #ccc);
  background-position: calc(100% - 20px) calc(1em + 2px),
    calc(100% - 15px) calc(1em + 2px), calc(100% - 2.5em) 0.5em;
  background-size: 5px 5px, 5px 5px, 1px 1.5em;
  background-repeat: no-repeat;
}

select.minimal:focus {
  background-image: linear-gradient(45deg, green 50%, transparent 50%),
    linear-gradient(135deg, transparent 50%, green 50%),
    linear-gradient(to right, #ccc, #ccc);
  background-position: calc(100% - 15px) 1em, calc(100% - 20px) 1em,
    calc(100% - 2.5em) 0.5em;
  background-size: 5px 5px, 5px 5px, 1px 1.5em;
  background-repeat: no-repeat;
  border-color: green;
  outline: 0;
}

select:-moz-focusring {
  color: transparent;
  text-shadow: 0 0 0 #000;
}

body {
  background-color: rgb(0, 159, 214);
  font: bold 1em/100% "Helvetica Neue", Arial, sans-serif;
  padding: 2em 0;
  text-align: center;
}
h1 {
  color: white;
  line-height: 120%;
  margin: 0 auto 2rem auto;
  max-width: 30rem;
}


</style>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>




</head>
<body >




<h1 id="status"> 
  Use WebSocket client to connect to MQTT server </h1>

<select class="mode_run" id="mode_run_c" >
        <option value="-1"> MODE ??</option>
        <option value="1">1 Pause</option>
        <option value="2">2 Continue</option>
</select>



<br><br>
<select class="so_cang" id="so_cang_max_c">


        <option value="-1"> CANG MAX ??</option>
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>

        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>

        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>

        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>

        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>




</select>

<br><br>

<select class="enable_stop" id="enable_stop_c" >
        <option value="-1"> ST ??</option>
        <option value="0">0 STOP</option>
</select>


<br><br>

<select class="enable_reset" id="enable_reset_er_c" >
        <option value="-1"> ER ??</option>
        <option value="0">0 NO</option>
        <option value="1">1 RESET ERROR</option>
</select>



<br><br>

<select class="set_max_rpm" id="max_rpm_c" >
        <option value="-1"> MAX RPM ??</option>
        <option value="1000">MAX rpm 1000</option>
        <option value="1100">MAX rpm 1100</option>
        <option value="1200">MAX rpm 1200</option>
        <option value="1300">MAX rpm 1300</option>
        <option value="1400">MAX rpm 1400</option>
        <option value="1500">MAX rpm 1500</option>
        <option value="1600">MAX rpm 1600</option>
        <option value="1700">MAX rpm 1700</option>
        <option value="1800">MAX rpm 1800</option>
        <option value="1900">MAX rpm 1900</option>
        <option value="2000">MAX rpm 2000</option>
        <option value="2100">MAX rpm 2100</option>
        <option value="2200">MAX rpm 2200</option>
        <option value="2300">MAX rpm 2300</option>
        <option value="2400">MAX rpm 2400</option>
        <option value="2500">MAX rpm 2500</option>
        <option value="2600">MAX rpm 2600</option>
        <option value="2700">MAX rpm 2700</option>
</select>






<br><br>

<select class="set_min_rpm" id="min_rpm_c" >
        <option value="-1">MIN rpm ??</option>
        <option value="1000">MIN rpm 1000</option>
        <option value="1100">MIN rpm 1100</option>
        <option value="1200">MIN rpm 1200</option>
        <option value="1300">MIN rpm 1300</option>
        <option value="1400">MIN rpm 1400</option>
        <option value="1500">MIN rpm 1500</option>
        <option value="1600">MIN rpm 1600</option>
        <option value="1700">MIN rpm 1700</option>
        <option value="1800">MIN rpm 1800</option>
        <option value="1900">MIN rpm 1900</option>
        <option value="2000">MIN rpm 2000</option>
        <option value="2100">MIN rpm 2100</option>
        <option value="2200">MIN rpm 2200</option>
        <option value="2300">MIN rpm 2300</option>
        <option value="2400">MIN rpm 2400</option>
        <option value="2500">MIN rpm 2500</option>
        <option value="2600">MIN rpm 2600</option>
        <option value="2700">MIN rpm 2700</option>
</select>









<br><br>
<select class="set_tam_de" id="tam_de_c">


        <option value="-1"> TẤM DÈ??</option>
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>

        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>

        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>

        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>

        <option value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>




</select>






<br><br>

<select class="set_chinh_nghieng" id="chinh_nghieng_c" >
        <option value="-1">Chỉnh nghiêng ??</option>
        <option value="0">NO</option>
        <option value="1">Nghiêng 1 trục</option>
        <option value="2">Nghiêng 2 trục</option>
        <option value="3">Nghiêng 3 trục</option>
</select>






</body>




<script>
    // Globally initializes an mqtt variable
   

    //onload="startrefreshIFrame()"
</script>



<script>
    const clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8)
    const host = 'ws://broker.hivemq.com:8000/mqtt'
    const options = {
      keepalive: 60,
      clientId: clientId,
      protocolId: 'MQTT',
      protocolVersion: 4,
      clean: true,
      reconnectPeriod: 1000,
      connectTimeout: 30 * 1000,
      will: {
        topic: 'WillMsg',
        payload: 'Connection Closed abnormally..!',
        qos: 0,
        retain: false
      },
    }
    console.log('Connecting mqtt client')
    const client = mqtt.connect(host, options)
    client.on('error', (err) => {
      console.log('Connection error: ', err)
      client.end()
    })
    client.on('reconnect', () => {
      console.log('Reconnecting...')
    })



client.on('connect', () => {
  console.log('Client connected:' + clientId)
  // Subscribe
  client.subscribe('ESPRTK_RESPOND_TOPIC', { qos: 1 })
   startrefreshIFrame();

  

})




         function startrefreshIFrame() {
                 setInterval(refreshIFrame, 30);
         }

var old_mode_control = -1000;
var old_so_cang_max = -1000;
var old_enable_reset_er = -1000;
var old_max_rpm = -1000;
var old_min_rpm = -1000;
var old_tam_de= -1000;
var old_chinh_nghieng = -1000;


         function refreshIFrame() {
// Publish


let mode_control =  parseInt(document.getElementById("mode_run_c").value);
let so_cang_max =  parseInt(document.getElementById("so_cang_max_c").value);
let enable_reset_er =  parseInt(document.getElementById("enable_reset_er_c").value);
let max_rpm =  parseInt(document.getElementById("max_rpm_c").value);
let min_rpm =  parseInt(document.getElementById("min_rpm_c").value);



let tam_de =  parseInt(document.getElementById("tam_de_c").value);
let chinh_nghieng =  parseInt(document.getElementById("chinh_nghieng_c").value);


if(min_rpm > max_rpm){
  min_rpm = max_rpm ;
}


     if( parseInt(document.getElementById("enable_stop_c").value) ==0){
      document.getElementById("mode_run_c").value = -1;
      mode_control = 0;

     }else{
        mode_control =  parseInt(document.getElementById("mode_run_c").value);

      }



if( mode_control != old_mode_control
|| so_cang_max != old_so_cang_max
|| old_enable_reset_er != enable_reset_er
|| old_max_rpm != max_rpm
|| old_min_rpm != min_rpm
|| old_tam_de!= tam_de
|| old_chinh_nghieng != chinh_nghieng

 ){

           console.log("Sent mg!");
    old_so_cang_max = so_cang_max ;
    old_mode_control = mode_control ;
     old_enable_reset_er = enable_reset_er;
     old_max_rpm = max_rpm ;
old_min_rpm = min_rpm;

    client.publish('testtopic111111_789_7878', '{"data":{   "reset_er_c":"'+enable_reset_er
      
                   +'" ,"min_rpm_c":"'+min_rpm
                   +'" ,"max_rpm_c":"'+max_rpm
                   +'" ,"mode_run_c":"'+mode_control
                   +'" ,"so_cang_max":"'+so_cang_max
                   +'" ,"tam_de":"'+tam_de
                   +'" ,"nghieng":"'+chinh_nghieng
                   +'"  }}', { qos: 1, retain: false })

}




        }



// Received
client.on('message', (topic, message, packet) => {
 // console.log('Received Message: ' + message.toString() + '\nOn topic: ' + topic)



document.getElementById("status").innerHTML = message.toString() ;



})




</script>
